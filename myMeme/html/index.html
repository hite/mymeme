<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Welcome to mymeme</title>
		<script src="/mymeme/js/service.js" type="text/javascript"></script>
		<script src="/mymeme/ext/mootools-1.2.4-core-nc.js" type="text/javascript"></script>
		<link href="/mymeme/css/meme.css" rel="stylesheet"/>
	</head>
	<body>
		<div class="banner">
			<h1>第三方meme客户端</h1>
			<div class="navigator">
					<a href="popular.html">popular</a>
					<a href="#home"  onclick="toDashBoard()">home</a>
					<a href="#index" onclick="toUserHome();">myMeme</a>
			</div>
		</div>
		<div class="guid-userName">
			<label>如果你记得你的用户名的话可以输入点击“更换用户":
			<label>Guid</label><span><input type="text" name="guid" id="guid" value="GOVBVW5VM3DPIUWR75JOYO4WZ4"  style="width: 300px;"/></span>
			<label>用户名</label><span><input type="text" name="userName" id="userName" value="hite"/></span>
			<span><input type="button" name="更换用户" value="更换用户" onclick="changeUser();"/></span>
		</div>
		<div id="userInfo">
			loading......
		</div> 
		<div id="posts">
			
		</div>
		<div class="nextpage">
			
			<button name="More" onclick="morePage(); makeQuery();" value="More" title="More" type="button">More</button> 
		</div>
	</body>
</html>

<script type="text/javascript" src="http://js.tongji.linezing.com/1505923/tongji.js"></script>
<script type="text/javascript">
	window.addEvent("load",function(){
		var un = paramsMap(window.location.search)["userName"];
		var g = paramsMap(window.location.search)["guid"];
		if(un){
			$("userName").value = un;
		}
		if(g){
			$("guid").value = g;
		}
		
		makeQuery();
	});
	function changeUser(){
		var un = $("userName").value ;
		var query = {
			q:"SELECT * FROM meme.info WHERE  name = '"+un+"'",
			format:'json',
			asyn:false,
			cbFunction:function(data){
				var m = data.query.results.meme;
				if(m.guid){
					$("guid").value = m.guid ;
				}else{
					alert("No such User in Yahoo Meme!");
				}
			}
		};
		
		new Ajax(query);	
	}
	var makeQuery = function(){
	    var user = User();
		var queue = new Array();
	  	 queue.push({
			q:"select * from meme.info where owner_guid='"+user.guid+"'",
			format:'json',
			cbFunction:'bombFactory'
		});
	  	 queue.push({
			q:"select * from meme.posts("+curpage*pageSize+","+pageSize+")  where owner_guid ='"+user.guid+"'",
			format:'json',
			cbFunction:'bombFactory'
		});
		
		$each(queue,function(query){
			new Ajax(query);	
		});
	 }
	
	 var bombFactory = function(reply){
	 		var data = reply;
	 		var posts = data.query.results.post;
	
		 	var m = data.query.results.meme;
		 	if (m) {
	 		//meme.info
				if (/loading/i.test(document.getElementById("userInfo").innerHTML)) {
					document.getElementById("userInfo").innerHTML = userInfo(m);
				}
			//meme.follower
			}//else {
				//alert("no such user found! type another again.");
			//}
			
			var posts = data.query.results.post;
			if(posts){
				if (posts.length > 0) {
					//meme.post
					post(posts).inject($("posts"));
				}else {
					alert("no any posts found! type another user again.");
				}
			}
			
	 }
</script>